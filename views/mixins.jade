

mixin textInShape(textValue, colorValue, percentFill, radius)
    -percentNotFilled = 100 - percentFill;
    -percentNotFilledPlus = percentNotFilled + 5;
    div(style="height:100px; width:100px;")
        div(style="height:100px; width:100px; position:absolute; border:solid; background:#{colorValue}; border-radius:#{radius};")
        div(style="position:absolute; height:110px; width: #{percentNotFilledPlus}px; left: #{percentNotFilled}px; background:white;")
        div(style="height:100px; width:100px; position:absolute; border:solid; border-radius:#{radius};")
        div(style="height:100px; width:100px; position:absolute; align-items:center; display:flex; justify-content:center;") #{textValue}

mixin indicator(indicatorName, indicatorDescription, descriptionOfCalculation, id)
    div(style="display:flex;" id=id draggable="true" ondragstart="drag(event)")
        div(style="border:solid;")
            div #{indicatorName}
            div #{indicatorDescription}
            div #{descriptionOfCalculation}
        div(style="border:solid; align-self:center;") Add

mixin site(siteName, siteDescription)
    div(style="border:solid;" onclick="selectSite(#{siteName})")
        div #{siteName}
        div #{siteDescription}

mixin header(displayLoginInfo)
    //the header should behave like this one: rubygarage.org
    div(class="showWhenNarrow")
        div Hi, I'm the special thing that only shows up when the screen is narrow :)
    div(class="hideWhenNarrow")
        div(style="width:100%; position:fixed; display:flex; flex-grow:1; z-index: 2;")
            div(style="height:100px; background:white; flex-grow:1;")
            div(style="max-width:1200px; display:flex; justify-content:space-between; height: 40px; width:100%; flex-grow:5;")
                div
                    div(style="position:fixed; width:100%; max-width:1200px; height:35px; background-color:#b8ddc3; z-index:-1; top:0px;")
                    div(style="position:fixed; width:100%; max-width:1200px; height:35px; background-color:#eff6e8; z-index:-1; top:35px;")
                    div(style="position:fixed; width:100%; max-width:1200px; height:5px; background:white; z-index:-1; top: 70px;")
                    img(src="/images/UBHub_logo_mainwebsite.svg" style="height:100px; margin-bottom:10px;")
                div(style="width:100%;")
                    div
                        div(style="display:flex; justify-content:space-between;")
                            -if(displayLoginInfo){
                                div(style="padding:0px 100px 0px 50px; display:flex; justify-content:space-around; flex-grow:1;")
                                    div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;" onclick="window.location='/dashboard'") myHub
                                    div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;" onclick="window.location='/indicators'") Indicators
                                    div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;" onclick="window.location='/forum'") Forum
                                    div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;") Account
                                div(style="padding:4px 5px 2px 2px;")
                                    div(style="background-color:#d3e9d5; color:#316b59; padding:5px 30px 5px 30px; border-radius:20px; font-weight:700;") #{username} User Name
                                //div(style="text-decoration:underline; cursor:pointer; color:#4490ba;" onclick="logOut()") Log out
                            -}else{
                                div(style="color:#fab279; font-weight:700;") Signup / Log in
                            -}
                    div(style="display:flex; justify-content:space-between;")
                        div(style="display:flex; justify-content:space-around; flex-grow:1;")
                            div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;" onclick="window.location='/home'") Home
                            div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;" onclick="window.location='/map'") mapHub
                            div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;" onclick="window.location='/resources'") guideHub
                            div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;" onclick="window.location='/aboutUs'") About US
                            div(style="padding:10px; cursor:pointer; color:#316b59; font-weight:700;") Get Involved
                        div(style="padding:2px 5px 2px 2px;")
                            div(style="background-color:#d3e9d5; cursor:pointer; color:#316b59; padding:5px 45px 5px 45px; border-radius:20px; font-weight:700;") Search
            div(style="height:75px; background:white; flex-grow:1;")

        div(style="width:100%; height:80px;")

mixin indexPostLinks(posts)
  div.indexPostLinks
    each post in posts
      +singlePostLink(post)

mixin singlePostLink(post)
  div.singlePostLink(id="post#{post.id}")
    +postVotes(post)
    div.postLinkContent
      p.forumAsker #{post.author} asks:
      h3(class="forumTitle" onclick="goToPost(#{post.id})" style="cursor:pointer;") #{post.subject}
      +postLinkMeta(post)

mixin responsePosts(posts)
  div.indexPostLinks
    each post in posts
      +singleResponsePost(post)

mixin singleResponsePost(post)
  div.singlePostLink(id="post#{post.id}" class=post.acceptedAnswer ? "accepted" : "")
    if post.acceptedAnswer
      p.acceptedBadge Accepted Answer:
    p.forumAsker #{post.author} says:
    h3.forumTitle #{post.subject}
    p.postBody #{post.body}
    +postMeta(post)
    +responseComments(post.children)
    +discussionResponseBox(post)

mixin responseComments(posts)
  div.comments
    each post in posts
      +singleComment(post)

mixin singleComment(post)
  div.singleComment
    p.forumAsker #{post.author} says:
    p.postBody #{post.body}

mixin discussionResponseBox(post)
  div(class="responseBox hide" id="responseBox#{post.id}")
    form(action="" id="responseForm#{post.id}")
      label Your response:
      input(type="hidden" name="questionTitle" value="Re: #{post.subject}")
      textarea(name="questionBody")
      input(type="hidden" name="parentPost" value="#{post.id}")
      input(type="button" onClick="submitQuestion('responseForm#{post.id}', true)" value="Submit Comment")


mixin postMeta(post)
  div.forumPostMeta
    span.upvotes(onClick="vote(#{post.userVoteStatus}, 1, #{post.id})") +
      span.number(id="upvotes-#{post.id}") #{post.upvotes}
    span.downvotes(onClick="vote(#{post.userVoteStatus}, -1, #{post.id})") -
      span.number(id="downvotes-#{post.id}")  #{post.downvotes}
    span.views v
      span.number #{post.views}
    -var tags = post.tags.split(',');
    each tag in tags
        span.tag #{tag}
    button(class="replyButton" onClick="replyTo(#{post.id}, #{post.parent})") Reply
    if post.canAccept
      button(class="replyButton" onClick="accept(#{post.id}, #{post.parent})") Accept


mixin postVotes(post)
  div.forumPostVotes
    span.upvotes +
      span.number(id="upvotes-#{post.id}")  #{post.upvotes}
    span.votesDelta
      span.number(id="votes-#{post.id}") #{post.votesDelta}
    span.downvotes â€“
      span.number  #{post.downvotes}

mixin postLinkMeta(post)
  div.postLinkMeta
    p.postLinkStatus Asked #{post.stringCreationDate}. #{post.stringAnsweredBy}
      a(href="/forum/post?id=#{post.id}")  Join the discussion!

mixin forumHeader()
  div.forumHeader
    div.searchOption
      form(action="/forum/search"  method="GET")
        input(type="text" placeholder="Search the forums for discussions and answers" name="s")
        button(value="Submit") Search
    if sort
      div.sortOption Sort by:
        if sort == "score"
          span(onclick="resortBy('date')") Most Recent |
          span.active Best Voted
        if sort == "date"
          span.active Most Recent |
          span(onclick="resortBy('score')") Best Voted
    div.askOption
      button(value="Ask a Question" onclick="askQuestion()") Ask a Question

mixin forumPager(posts)
  div.forumPager
    p PAGE
    p.pager
      if lastPage
        span.pageButton(onclick="turnPage(#{lastPage})") <
      span.pageCount #{page}/#{finalPage}
      if nextPage
        span.pageButton(onclick="turnPage(#{nextPage})") >



mixin footer()
    div(style="margin:auto; max-width:1200px; display:flex; justify-content:space-between; padding-top:10px;")
        div
            img(src="/images/UBHub_logo_horizwebsite.svg" style="height:60px; margin-bottom:10px;")
        div(style="width:200px;" class="smallText") The Urban Biodiversity Hub (UBHub) helps cities around the world to choose a biodiversity strategy, then measure and improve their Biodiversity Strategy and Action Plans (BSAPs).
        div
            div(class="smallText") Home
            div(class="smallText") myHub
            div(class="smallText") GuideHub
            div(class="smallText") About Us
            div(class="smallText") Forum
            div(class="smallText") Account
            div(class="smallText") Sitemap
        div
            div(class="smallText") Contact us
            div(class="smallText") ubhub.org@gmail.com
            div(class="smallText") Copyright info
            a(class="twitter-follow-button" href="https://twitter.com/ubhub_org") Follow @ubhub_org


script.
    window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
        if (d.getElementById(id))
        return t;
    js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function(f) {
            t._e.push(f);
    };

    return t;
    }(document, "script", "twitter-wjs"));

script.
    function httpPost(theUrl, callback, data) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("POST", theUrl, true); // true for asynchronous
        xmlHttp.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        var dataAsJson = JSON.stringify(data);
        xmlHttp.send(dataAsJson);
    }
