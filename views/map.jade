doctype html
html
    head
        title Map
        script(async, defer, src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEKjvE48-VV37P2pGBWFphvlrx8BXGDCs&callback=initMap")
        link(rel='stylesheet', href='/stylesheets/style.css')

mixin filterMixin(filterBy, attributeList)
    select(style="flex-grow:1; margin: 5px;" onchange="filter(this.value, #{filterBy})").border
        option(value="none").option
        each attributeItem in attributeList
            option(value=attributeItem).option #{attributeItem}

//mixin filterRangeMixin(filterBy, low, high)
//    select(style="flex-grow:1; margin: 5px;" onchange="filterRange(this.value, #{filterBy})").border
//        option(value="none").option
//        each attributeItem in attributeList
//            option(value=[low, high]).option #{low} < #{high}

mixin checkboxMixin(value, label)
    div
        input(type="checkbox", name="#{value}").checkbox
        span.label #{label}

mixin textBoxMixin(value, label)
    div(style="display:flex; width:100%;").fullLine
        span.label #{label}
        input(type="text", name="#{value}", style="flex-grow:1; margin-left:5px;")

body

    h3 CBI Coalition Map
    div(onclick="resetFilter()").border Reset!
    div(style="display:flex;").filters
        select(style="flex-grow:1; margin: 5px;" onchange="filter(this.value, 'country')").border
            option(value="none").option
            option(value="England").option England
            option(value="India").option India
        +filterMixin("'scale'", ['global', 'international', 'city-state/autonomous city', 'subnational/provincial', 'district/county', 'metro region', 'municipality', 'community', 'urban reserve', 'campus', 'institution'])
        //+filterRangeMixin("'population'", 0, 1000000)

    div(id="map" style="height:400px; width:100%;")
    form(name="add-estimation", method="post" style="display:flex; flex-direction:column; flex-grow:1; flex-shrink:1; width: 100%;")
        div(style="width:50%")
            +textBoxMixin("title", "Title")
            div.fullLine
                span.label Type
                select(name="type").select
                    option(value="none").option
                    option(value="data").option data
                    option(value="repository").option repository
                    option(value="environmentalNGO").option environmental NGO
                    option(value="news").option news source/blog
                    option(value="indexTool").option index/measurement tool
                    option(value="plan").option plan/strategy
                    option(value="toolkitGuide").option toolkit/guide
                    option(value="researcherExpert").option researcher/expert
                    option(value="researchInstitute").option research institute
                    option(value="pubEngagementInstitute").option public engagement institute
                    option(value="networkPartnershipProgram").option network/partnership program
                    option(value="government").option government
                    option(value="event").option event
                    option(value="map").option map
                    option(value="otherType").option other
            div.fullLine
                span.label Scale
                select(name="scale").select
                    option(value="none").option
                    option(value="institution").option institution
                    option(value="campus").option campus
                    option(value="reserve").option urban reserve/wildlife park
                    option(value="neighborhood").option community/neighborhood
                    option(value="municipality").option municipality
                    option(value="metro region").option metro region
                    option(value="district").option district/county
                    option(value="subnational").option subnational/provincial
                    option(value="city").option city-state/autonomous city
                    option(value="national").option national
                    option(value="international").option international
                    option(value="global").option global
                    option(value="N/A").option N/A
            +textBoxMixin("url", "Main weblink")
            +textBoxMixin("author", "Author/Organization")
            div.fullLine
                span.label Description
                textarea(name="description", cols="40", rows="5").select
            +textBoxMixin("location", "Location")
        div.input.border
            div.label Tags
            div(style="background-color:#d8ecd4; display:grid; grid-template-columns:1fr 1fr 1fr 1fr; font-size:11px; margin:5px;").input
                div(style="grid-column-start:1; grid-column-end:5; display:inline; padding:5px;")
                    div(style="display:inline; font-size:18px; font-weight:700;").label Ecosystems
                    div(style="display:inline; margin-left:5px;")
                        input(type="checkbox", name="all").checkbox
                        span.label CHECK ALL
                +checkboxMixin("streams", "streams")
                +checkboxMixin("delta", "river delta")
                +checkboxMixin("oceans", "oceans")
                +checkboxMixin("lakes", "lakes")
                +checkboxMixin("wetlands", "wetlands")
                +checkboxMixin("desert", "desert")
                +checkboxMixin("forest", "forest")
                +checkboxMixin("grassland", "savannah")
                +checkboxMixin("steppe", "steppe/montane")
                +checkboxMixin("tundra", "tundra/polar")
                +checkboxMixin("shrubland", "shrubland")
                +checkboxMixin("intertidal", "intertidal/beach")
                +checkboxMixin("rooftop", "rooftop/vertical")
                +checkboxMixin("rocky", "rocky")
                +checkboxMixin("cave", "cave/underground")
                +checkboxMixin("lawns", "lawns and gardens")
                +checkboxMixin("cropFields", "crop fields")
                +checkboxMixin("microbial", "microbial")
                +checkboxMixin("other", "other")
                    input(type="text", name="OtherText", style="margin:5px;")
            div.input
                div.label Governance
                    +checkboxMixin("policy", "policy")
                    +checkboxMixin("index", "index")
                    +checkboxMixin("regulation", "regulation")
                    +checkboxMixin("spatialPlanning", "spatial planning")
                    +checkboxMixin("developmentPartnerships", "development partnerships")
                    +checkboxMixin("mainstreaming", "mainstreaming")
                    +checkboxMixin("otherGovernance", "other")
            div.input
                div.label Consumption
                    +checkboxMixin("footprintMeasurement", "footprint measurement")
                    +checkboxMixin("sustainablePurchasing", "sustainable purchasing")
                    +checkboxMixin("shareholderActivism", "shareholder activism")
                    +checkboxMixin("urbanAgriculture", "urban agriculture")
                    +checkboxMixin("foraging", "foraging")
                    +checkboxMixin("otherConsumption", "other")
            div.input
                div.label Ecosystem Services
                +checkboxMixin("Food", "Food")
                +checkboxMixin("rawMaterials", "Raw Materials")
                +checkboxMixin("freshWater", "Fresh Water")
                +checkboxMixin("medicinalResources", "Medicinal Resources")
                +checkboxMixin("localClimate", "Local climate and air quality")
                +checkboxMixin("carbonSequestration", "Carbon sequestration and storage")
                +checkboxMixin("moderation", "Moderation of extreme events")
                +checkboxMixin("wasteWaterTreatment", "Waste-water treatment")
                +checkboxMixin("erosionPrevention", "Erosion prevention and maintenance of soil fertility")
                +checkboxMixin("pollination", "Pollination")
                +checkboxMixin("biologicalControl", "Biological control")
                +checkboxMixin("habitatServices", "Habitat or supporting services")
                +checkboxMixin("habitatSpecies", "Habitats for species")
                +checkboxMixin("maintenance", "Maintenance of genetic diversity")
                +checkboxMixin("recreation", "Recreation and mental and physical health")
                +checkboxMixin("tourism", "Tourism")
                +checkboxMixin("aesthetic", "Aesthetic appreciation and inspiration for culture, art and design")
                +checkboxMixin("spiritual", "Spiritual experience and sense of place")
            div.input
                div.label Sustainable Development Goals
                +checkboxMixin("1", "1: No Poverty")
                +checkboxMixin("2", "2: Zero Hunger")
                +checkboxMixin("3", "3: Good Health and Well-being")
                +checkboxMixin("4", "4: Quality Education")
                +checkboxMixin("5", "5: Gender Equality")
                +checkboxMixin("6", "6: Clean Water and Sanitation")
                +checkboxMixin("7", "7: Affordable and Clean Energy")
                +checkboxMixin("8", "8: Decent Work and Economic Growth")
                +checkboxMixin("9", "9: Industry, Innovation and Infrastructure")
                +checkboxMixin("10", "10: Reduced Inequalities")
                +checkboxMixin("11", "11: Sustainable Cities and Communities")
                +checkboxMixin("12", "12: Responsible Consumption and Production")
                +checkboxMixin("13", "13: Climate Action")
                +checkboxMixin("14", "14: Life Below Water")
                +checkboxMixin("15", "15: Life on Land")
                +checkboxMixin("16", "16: Peace, Justice and Strong Institutions")
                +checkboxMixin("17", "17: Partnerships for the Goals")
            div.input
                div.label Parties Involved
                +checkboxMixin("localCommunity", "Local Community")
                +checkboxMixin("ngo", "NGO")
                +checkboxMixin("business", "Business")
                +checkboxMixin("academia", "Academia")
                +checkboxMixin("localGov", "Local Government")
                span.label Other
                input(type="text", name="otherPartiesInvolved")
        div.actions
            input(type="submit", value="submit")
script.
    var markers = [];
    function filter(value, filterBy){
        markers.forEach(function (marker) {
            marker.setVisible(marker.element[filterBy] == value);
        });
    };
    function resetFilter(){
        markers.forEach(function (marker) {
            marker.setVisible(true);
        });
    };
    function initMap() {
        var mapData =!{mapData};
        console.log(mapData);
        center = {lat: 20, lng: 15};
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 2,
            center: center,
            styles: [{"elementType": "geometry","stylers": [{"color": "#1d2c4d"}]}, {"elementType": "labels.text.fill","stylers": [{"color": "#8ec3b9"}]},{"elementType": "labels.text.stroke","stylers": [ { "color": "#1a3646" } ]},{"featureType": "administrative","stylers": [{"visibility": "simplified"}]},{"featureType": "administrative","elementType": "geometry","stylers": [{"color": "#6ab285"}]},{"featureType": "administrative", "elementType": "geometry.stroke", "stylers": [ { "color": "#d7e9cd" }, { "visibility": "on" } ] }, { "featureType": "administrative", "elementType": "labels.text", "stylers": [ { "color": "#d6e9cd" } ] }, { "featureType": "landscape", "stylers": [ { "color": "#3d7761" } ] }, { "featureType": "landscape.man_made", "elementType": "geometry.stroke", "stylers": [ { "color": "#334e87" } ] }, { "featureType": "landscape.natural", "stylers": [ { "color": "#298f6a" } ] }, { "featureType": "poi", "stylers": [ { "visibility": "off" } ] }, { "featureType": "poi", "elementType": "geometry", "stylers": [ { "color": "#283d6a" } ] }, { "featureType": "poi", "elementType": "labels.text.fill", "stylers": [ { "color": "#6f9ba5" } ] }, { "featureType": "poi", "elementType": "labels.text.stroke", "stylers": [ { "color": "#1d2c4d" } ] }, { "featureType": "poi.park", "stylers": [ { "color": "#6ab285" }, { "visibility": "simplified" } ] }, { "featureType": "poi.park", "elementType": "labels", "stylers": [ { "visibility": "off" } ] }, { "featureType": "poi.park", "elementType": "labels.icon", "stylers": [ { "visibility": "off" } ] }, { "featureType": "road", "elementType": "geometry", "stylers": [ { "color": "#2d1b5a" } ] }, { "featureType": "road", "elementType": "labels", "stylers": [ { "visibility": "off" } ] }, { "featureType": "road", "elementType": "labels.text.fill", "stylers": [ { "color": "#98a5be" } ] }, { "featureType": "road", "elementType": "labels.text.stroke", "stylers": [ { "color": "#1d2c4d" } ] }, { "featureType": "road.arterial", "stylers": [ { "visibility": "simplified" } ] }, { "featureType": "road.arterial", "elementType": "geometry", "stylers": [ { "visibility": "simplified" } ] }, { "featureType": "road.arterial", "elementType": "labels", "stylers": [ { "visibility": "off" } ] }, { "featureType": "road.highway", "stylers": [ { "visibility": "simplified" } ] }, { "featureType": "road.highway", "elementType": "labels", "stylers": [ { "visibility": "off" } ] }, { "featureType": "road.highway", "elementType": "labels.text.fill", "stylers": [ { "color": "#b0d5ce" } ] }, { "featureType": "road.highway", "elementType": "labels.text.stroke", "stylers": [ { "color": "#023e58" } ] }, { "featureType": "transit", "stylers": [ { "color": "#00907d" } ] }, { "featureType": "transit", "elementType": "labels", "stylers": [ { "visibility": "off" } ] }, { "featureType": "transit", "elementType": "labels.text.fill", "stylers": [ { "color": "#98a5be" } ] }, { "featureType": "transit", "elementType": "labels.text.stroke", "stylers": [ { "color": "#1d2c4d" } ] }, { "featureType": "water", "stylers": [ { "color": "#193c59" } ] }, { "featureType": "water", "elementType": "labels.text.fill", "stylers": [ { "color": "#4e6d70" } ] } ]});
            mapData.forEach(function (element) {

            var contentString =
                '<div id="content">' +
                    '<div id="siteNotice">' +
                    '</div>' +
                    '<h1 id="firstHeading" class="firstHeading">' + element.title + '</h1>' +
                    '<div id="bodyContent">' +
                        '<p>' + element.scale + '</p>' +
                    '</div>' +
                '</div>';

            var infowindow = new google.maps.InfoWindow({
                content: contentString
            });

            var position = {lat:element.lat, lng:element.lng};
            var marker = new google.maps.Marker({
                position: position,
                map: map,
                animation: google.maps.Animation.DROP,
                title: element.name,
                icon: '/images/marker-yellow-det.png'
            });
            marker.element = element;

            marker.addListener('click', function () {
                infowindow.open(map, marker);
            });
            markers.push(marker);
        });
    }
    //    function filterRange(range, filterBy) {
    //        markers.forEach(function (marker) {
    //            marker.setVisible(marker.element[filterBy] > range.low && marker.element[filterBy] < range.high);
    //        });
    //    };